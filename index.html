<!DOCTYPE HTML>
<html>
<head>
<title>Work with math.js</title>
<link rel="stylesheet" href="style.css"/>

<script type="text/javascript" async src="https://code.jquery.com/jquery-1.8.3.js"></script>

<script>window.MathJax = { MathML: { extensions: ["mml3.js", "content-mathml.js"]}};</script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="lib/mahtjs/math.min.js"></script>

<script src="cases/other/formula.js"></script>

<script src="src/mathsjs2cMathML.js"></script>
</head>
<body>

<div id="navigate">
	<h2>Navigate</h2>
</div>
<br/>
<button onclick='compact(-1)'>Compact</button><button onclick='full(-1)'>Full</button>

<script type="text/javascript">
var node, cont;
for (var i = 0; i < test_formula.length; i++) { 
	/*Generate <div> with information about formula*/
	document.write("<div id='data"+i+"'>");
		document.write("<h2>Example #"+i+"</h2>");
		document.write("<h3>input <b>"+test_formula[i]+"</b></h3>");
		document.write("<button onclick='compact("+i+")'>Compact</button><button onclick='full("+i+")'>Full</button></br>");
		document.write("<div id='json"+i+"' class='json'></div>");//Place for JSON
		document.write("<button onclick='compact("+i+")'>Compact</button><button onclick='full("+i+")'>Full</button></br>");
		document.write("<br/>");
		document.write('<h3>cMathML</h3>');
		document.write('<textarea id="textarea'+i+'" required></textarea>');//Place for cMathML
		document.write("<br/>");
		document.write('<table border="1px">');//Table for display formula
			document.write('<tr>');//Mathjs
				document.write('<td align="center">from MathsJS</td>');
				document.write('<td id="formula'+i+'"></td>');				
			document.write('</tr>');
			document.write('<tr>');//cMathML
				document.write('<td align="center">from cMathML</td>');
				document.write('<td id="cformula'+i+'"></td>');
			document.write('</tr>');			
		document.write('</table>');
		document.write("<a href='#navigate'>Up</a></br>");
		document.write("<hr/>");
	document.write("</div>");

    var exp_tree_mathjs = math.parse(test_formula[i]);

    var mathML = new MathXMLDom();
    var cMathML = mathML.createXMLDom(exp_tree_mathjs);
   
    var formula = exp_tree_mathjs.toTex();	
	formula = formula.replace(new RegExp("_",'g'),"\\_");//Screening '_'
    
    /*for output JSON mathjs expression tree*/
    var JSON_mathjs = JSON.stringify(exp_tree_mathjs, null, 2);
    JSON_mathjs = stripJSON(JSON_mathjs); //Get JSON with &nbsp; and <br/> for output
    
    /*for output cMathML-code*/
	var oSerializer = new XMLSerializer();
	sXML = oSerializer.serializeToString(cMathML);
    
	/* Fill <div>*/
	document.getElementById('formula'+i).innerHTML = '$$'+formula+'$$';
	document.getElementById('json'+i).innerHTML += JSON_mathjs+'<br/>';	
	document.getElementById('navigate').innerHTML += '<a href="#data'+i+'">Example #'+i+'</a><br/>';
	document.getElementById('textarea'+i).innerHTML = sXML.replace(new RegExp("><","g"),'>\n<');
	document.getElementById('cformula'+i).innerHTML = sXML;
}

/*Subscribe functions*/    
function stripJSON(cont) {
    "use strict";
	cont = cont.replace(new RegExp("\n","g"), "<br/>");
	cont = cont.replace(new RegExp(" ","g"), "&nbsp;");
	return cont;
}    
    
function compact(n) {
    "use strict";
    if (n >= 0) {
        (document.getElementsByClassName("json")[n]).style.height = "300px";
    }	
    else {	
        $(".json").css("height", "300px");
    }
}
	
function full(n) {
    "use strict";
	if (n >= 0) {
		(document.getElementsByClassName("json")[n]).style.height = "auto";
	}	
	else {	
		$(".json").css("height", "auto");
	}
}	
</script>	

</body>
</html>
