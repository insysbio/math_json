<!DOCTYPE HTML>
<html>
<head>
<title>Testing conversion from math.js node to cMathML</title>
<link rel="stylesheet" href="style.css"/>

<script type="text/javascript" async src="https://code.jquery.com/jquery-1.8.3.js"></script>

<script>window.MathJax = { MathML: { extensions: ["mml3.js", "content-mathml.js"]}};</script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="lib/mahtjs/math.min.js"></script>

<script src="cases/other/formula.js"></script>

<script src="src/mathsjs2cMathML.js"></script>
</head>
<body>

<div id="navigate">
	<h2>Navigate</h2>
</div>

<br/>

<button onclick="compact(-1)">Minify all</button><button onclick="full(-1)">Expand all</button>

<hr/>

<div id="content"></div>

<script type="text/javascript">
"use strict";
var node, 
    cont;
var content = document.getElementById("content");
test_formula.forEach(function(x, i) { 
	/*Generate <div> with information about formula*/
    var divData = document.createElement("div");
    divData.setAttribute("id", "data"+i); 
    
        var header2 = document.createElement("h2");
        header2.innerHTML = "Example #"+i;
		divData.appendChild(header2);
        
        var header3 = document.createElement("h3");
        header3.innerHTML = "input:";
		divData.appendChild(header3);
        
        var p = document.createElement("p");
        p.innerHTML = x;
        divData.appendChild(p);
        
        header3 = document.createElement("h3");
        header3.innerHTML = "parsing of input by math.js to Node object:"; 
		divData.appendChild(header3);
        
		var button = document.createElement("button");
        button.setAttribute("onclick", "compact("+i+")");
        button.innerHTML = "Minify";
        divData.appendChild(button);
        
        button = document.createElement("button");
        button.setAttribute("onclick", "full("+i+")");
        button.innerHTML = "Expand";
        divData.appendChild(button);
        
        var br = document.createElement("br");
        divData.appendChild(br);
        
        var innerDiv = document.createElement("div");
        innerDiv.setAttribute("id", "json"+i);
        innerDiv.setAttribute("class", "json");
        divData.appendChild(innerDiv);
        
        divData.appendChild(br);
        
        header3 = document.createElement("h3");
        header3.innerHTML = "cMathML produced by our code from Node object"; 
		divData.appendChild(header3);
        
		var textarea = document.createElement("textarea");
        textarea.setAttribute("id","textarea"+i);
        divData.appendChild(textarea);
                
		divData.appendChild(br);
        
        header3 = document.createElement("h3");
        header3.innerHTML = "MathJax presentation of TeX generated from input:"; 
		divData.appendChild(header3);
        
        innerDiv = document.createElement("div");
        innerDiv.setAttribute("id", "formula"+i);
        divData.appendChild(innerDiv);
    
        header3 = document.createElement("h3");
        header3.innerHTML = "MathJax presentation of cMathML generated by our code:"; 
		divData.appendChild(header3);
    
        innerDiv = document.createElement("div");
        innerDiv.setAttribute("id", "cformula"+i);
        innerDiv.setAttribute("style", "text-align:center");
        divData.appendChild(innerDiv);
        
        innerDiv = document.createElement("div");
        innerDiv.setAttribute("style", "padding:20px;");
            var link = document.createElement("a");
            link.setAttribute("href", "#navigate");
            link.innerHTML = "Up";
            innerDiv.appendChild(link);
        divData.appendChild(innerDiv);
    
        var hr = document.createElement("hr");
        divData.appendChild(hr);
    content.appendChild(divData);
    
    var expTreeMathjs = math.parse(x);
    var cMathML = math.toCMathML(expTreeMathjs);
    
    if (cMathML) {
       
        var formula = expTreeMathjs.toTex().replace(/_/g,"\\_");
        
        /*for output JSON mathjs expression tree*/
        var JSON_mathjs = stripJSON( JSON.stringify(expTreeMathjs, null, 2) );
        
        /*for output cMathML-code*/
        var sXML = (new XMLSerializer()).serializeToString(cMathML);
        
        /* Fill <div>*/
        document.getElementById("formula"+i).innerHTML = "$$"+formula+"$$";
        document.getElementById("json"+i).innerHTML += JSON_mathjs+"<br/>";	
        document.getElementById("navigate").innerHTML += "<a href='#data"+i+"'>Example #"+i+"</a><br/>";
        document.getElementById("textarea"+i).innerHTML = sXML.replace(/></g,">\n<");
        document.getElementById("cformula"+i).appendChild(cMathML);
    }
    else {
        document.getElementById("formula"+i).innerHTML = mathObject.toString()+": Incorrect symbol"+mathObject.toString().match(/[^\^*\/+-\w()_,. ]/)[0];
    }
    
  
});
/*Subscribe functions*/    
function stripJSON(cont) {
	cont = cont.replace(/\n/g, "<br/>");
	cont = cont.replace(/ /g, "&nbsp;");
	return cont;
}    
    
function compact(n) {
    if (n >= 0) {
        (document.getElementsByClassName("json")[n]).style.height = "300px";
    }	
    else {	
        $(".json").css("height", "300px");
    }
}
	
function full(n) {
	if (n >= 0) {
		(document.getElementsByClassName("json")[n]).style.height = "auto";
	}	
	else {	
		$(".json").css("height", "auto");
	}
}	
</script>	

</body>
</html>